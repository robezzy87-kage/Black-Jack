#Black-Jack_Robert_J_Ventura.py
import random
import time

# Global variables to keep track of the number of games played and wins
cards_played = 0
player_wins = 0
computer_wins = 0

# Initial betting amount
betting_amount = 1000

# List of possible cards in the game
cards = ['Ace', 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 'Queen', 'Jack', 'King']

# Welcoming the player and explaining the rules
player_one_name = input('Enter Player 1 name: ')
print(f'Welcome {player_one_name} to Black Jack!')
print('Rules: Get as close to 21 as possible without going over. Face cards are worth 10. Aces are worth 1 or 11. enjoy!')
print("You start with $1000. Good luck!")

# Function to determine the value of a card for the player
def card_value(card):

    # Face cards are worth 10
    if card in ['Queen', 'Jack', 'King']:
        return 10
    if card == 'Ace':
        return aceInteger(card)
    return int(card)

def card_value_npc(card):

    # Face cards are worth 10
    if card in ['Queen', 'Jack', 'King']:
        return 10
    # For computer, we will treat Ace as 11 unless it causes a bust
    if card == 'Ace':
        return 11
    return int(card)


# Uses random.choices to get 2 cards for player
def playerCards():
    randomCards = random.choices(cards, k=2)
    first_card = randomCards[0]
    second_card = randomCards[1]
    users_cards = []
    print(randomCards)

    users_cards.append(card_value(first_card))
    users_cards.append(card_value(second_card))

    print(f"Your sum for both cards is: {sum(users_cards)}")
    if sum(users_cards) == 21:
        time.sleep(1)
        print("Blackjack!")
        return users_cards
    if sum(users_cards) > 21:
        time.sleep(1)
        print("You busted!")
        return users_cards

    user_hit_stand = hit_stand()

    # Loop to allow the player to hit or stand
    while user_hit_stand == 'hit':
        new_card = random.choice(cards)
        users_cards.append(card_value(new_card))
        print(new_card)
        time.sleep(1)
        print(f"Your new sum is: {sum(users_cards)}")

        if sum(users_cards) > 21:
            time.sleep(1)
            print("you busted!")
            break

        elif sum(users_cards) == 21:
            time.sleep(1)
            print("Blackjack!")
            break 

        user_hit_stand = hit_stand()

    return users_cards


# Uses random.choices to get 2 cards for computer
def computerCards():
    randomCards = random.choices(cards, k=2)
    first_card = randomCards[0]
    second_card = randomCards[1]
    computer_cards = []
    print("Computer's cards are: ")
    print(randomCards)

    computer_cards.append(card_value_npc(first_card))
    computer_cards.append(card_value_npc(second_card))

    print(f"Computer's sum for both cards is: {sum(computer_cards)}")

    # Loop to allow the computer to hit until reaching at least 17
    while sum(computer_cards) < 17:
        time.sleep(1)
        print("Computer hits.")
        new_card = random.choice(cards)
        if new_card == 'Ace' and sum(computer_cards) + 11 > 21:
            computer_cards.append(1)
        computer_cards.append(card_value_npc(new_card))
        time.sleep(1)
        print(new_card)
        print(f"Computer's new sum is: {sum(computer_cards)}")
        if sum(computer_cards) > 21:
            time.sleep(1)
            print("Computer busted!")
            break
        elif sum(computer_cards) == 21:
            time.sleep(1)
            print("Computer got Blackjack!")
            break 
    return computer_cards

# Determines the winner based on the sums of player and computer cards
def determine_winner(player_cards, computer_cards):
    player_sum = sum(player_cards)
    computer_sum = sum(computer_cards)
    time.sleep(2)

    # Both busted
    if player_sum > 21 and computer_sum > 21:
        return "It's a tie."

    # One busted
    if player_sum > 21:
        return "Computer wins!"

    if computer_sum > 21:
        return f"{player_one_name} wins!"

    # Both valid â†’ compare closeness
    player_diff = 21 - player_sum
    computer_diff = 21 - computer_sum

    if player_diff < computer_diff:
        return f"{player_one_name} wins!"
    elif computer_diff < player_diff:
        return "Computer wins!"
    else:
        return "It's a tie."
    
# Function to handle Ace value input from the player
def aceInteger(ace):
    if ace == 'Ace':
        while True:
            try:
                value = int(input("You got an Ace! Enter 1 or 11: "))
                if value in (1, 11):
                    return value
            except ValueError:
                pass
            print("Invalid input. Please enter 1 or 11. ")

# Function to convert face cards to their integer values
def face_cards_converter(card):
    if card in ['Queen', 'Jack', 'King']:
        card = 10
    return card

# Function to sum up six card values
def sum_of_cards(first_card, second_card, third_card, fourth_card, fifth_card, sixth_card):
    return first_card + second_card + third_card + fourth_card + fifth_card + sixth_card

# Function to get player's choice to hit or stand
def hit_stand():
    while True:
        try:
            value =  input("Would you like to hit or stand? ").strip().lower()
            time.sleep(2)
            if value in ('hit', 'stand'):
                return value
        except ValueError:
            pass
        print("Invalid input. Please enter \"hit\" or \"stand\". ")

# Function to handle the player's choice to play again
def win_tally(winner):
    global cards_played, player_wins, computer_wins, betting_amount
    cards_played += 1

    if winner == f"{player_one_name} wins!":
        player_wins += 1
        betting_amount += int(player_betting_amount)
    elif winner == "It's a tie.":
        print(f'{player_one_name}, it\'s a tie. You keep your bet.')
    else:
        computer_wins += 1
        betting_amount -= int(player_betting_amount)


    if betting_amount <= 0:
        print(f'{player_one_name}, you have no more money to bet. Game over.')
        print(f'Total games played: {cards_played}')
        print(f'{player_one_name} wins: {player_wins}')
        print(f'Computer wins: {computer_wins}')
        exit()

    print(f'Total games played: {cards_played}')
    print(f'{player_one_name} wins: {player_wins}')
    print(f'Computer wins: {computer_wins}')

play_again = input("Would you like to play Black Jack? (yes/no): ").strip().lower()
if play_again == 'yes':
    while True:
        try:
            player_betting_amount = int(input("Enter your betting amount you want to bet: "))
            if player_betting_amount <= betting_amount:
                break
        except ValueError:
            pass
        print("Invalid input. Please enter a valid number. ")

# Main game loop
while play_again == 'yes':
    winner = determine_winner(playerCards(), computerCards())
    win_tally(winner)
    print(winner)
    play_again = input("Would you like to play Black Jack? (yes/no): ").strip().lower()
    print(f"Your current betting amount is: ${betting_amount}")
    if play_again == 'yes':
        while True:
            try:
                player_betting_amount = int(input("Enter your betting amount you want to bet: "))
                if player_betting_amount <= betting_amount:
                    break
            except ValueError:
                pass
            print("Invalid input. Please enter a valid number. ")
    

print('Thanks for playing! Goodbye!')
